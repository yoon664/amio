<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회전 카드 뷰어</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: white;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        .table {
            position: relative;
            width: 600px;
            height: 600px;
        }

        .card-container {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.3s ease;
            cursor: grab;
        }

        .card-container:active {
            cursor: grabbing;
        }

        .card {
            position: absolute;
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid #ddd;
            opacity: 0;
            transform-origin: center;
        }

        .card.visible {
            opacity: 1 !important;
        }

        .card:hover {
            z-index: 15;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .card-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .drag-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        @keyframes dealCard {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                opacity: 0.3;
            }
        }

        .card.dealing {
            animation: dealCard 0.8s ease-out forwards;
        }

        .card.visible {
            opacity: 1 !important;
        }
    </style>
</head>
<body>
    <div class="table">
        <div class="card-container" id="cardContainer">
        </div>
    </div>
    
    <div class="drag-hint">
        🖱️ 드래그해서 카드를 회전시키세요
    </div>

    <script>
        let cardImage = null;
        let isDragging = false;
        let startAngle = 0;
        let currentRotation = 0;
        let lastMouseAngle = 0;
        const cardCount = 16;
        const visibleCardCount = 5;

        // 카드 이미지 설정
        async function loadCardImage() {
            cardImage = 'img/1.png';
        }

        // 마우스 위치를 각도로 변환
        function getAngleFromMouse(clientX, clientY) {
            const rect = document.querySelector('.table').getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            const deltaX = clientX - centerX;
            const deltaY = clientY - centerY;
            
            return Math.atan2(deltaY, deltaX) * 180 / Math.PI;
        }

        // 보이는 카드 업데이트
        function updateVisibleCards() {
            const cards = document.querySelectorAll('.card');
            const centerIndex = Math.round(-currentRotation / (360 / cardCount)) % cardCount;
            const normalizedCenterIndex = centerIndex < 0 ? centerIndex + cardCount : centerIndex;
            
            console.log('현재 중앙 인덱스:', normalizedCenterIndex);
            
            cards.forEach((card, index) => {
                card.classList.remove('visible');
                
                // 중앙을 기준으로 앞뒤 2개씩, 총 5개 카드가 보이도록
                const distanceFromCenter = Math.min(
                    Math.abs(index - normalizedCenterIndex),
                    cardCount - Math.abs(index - normalizedCenterIndex)
                );
                
                if (distanceFromCenter <= 2) {
                    card.classList.add('visible');
                    console.log(`카드 ${index + 1} visible 추가, distance: ${distanceFromCenter}`);
                }
            });
        }

        // 카드 생성 및 배치
        async function createCards() {
            await loadCardImage();
            
            const container = document.getElementById('cardContainer');
            const centerX = 300;
            const centerY = 300;
            const radius = 220;

            for (let i = 0; i < cardCount; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                
                // 각도 계산 (12시 방향부터 시작)
                const angle = (360 / cardCount) * i - 90; // -90도로 12시 방향 시작
                const radian = (angle * Math.PI) / 180;
                
                const x = centerX + Math.cos(radian) * radius;
                const y = centerY + Math.sin(radian) * radius;
                
                card.style.left = (x - 40) + 'px';
                card.style.top = (y - 60) + 'px';
                
                // 카드가 중앙을 향하도록 회전
                const rotationAngle = angle + 90;
                card.style.transform = `rotate(${rotationAngle}deg)`;
                
                card.innerHTML = `
                    <img src="${cardImage}" alt="고객 리뷰${i + 1}" onerror="this.style.display='none'">
                    <div class="card-number">${i + 1}</div>
                `;
                
                // 카드 클릭 이벤트 (뒤집기 애니메이션 제거)
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    console.log(`카드 ${i + 1} 클릭됨`);
                });
                
                container.appendChild(card);
                
                setTimeout(() => {
                    card.classList.add('dealing');
                }, i * 100);
            }
            
            // 초기 보이는 카드 설정 (위쪽 5개 카드가 보이도록)
            setTimeout(() => {
                updateVisibleCards();
                console.log('초기 visible 카드 설정 완료');
            }, cardCount * 100 + 1000);
        }

        // 드래그 이벤트
        function handleMouseDown(e) {
            isDragging = true;
            startAngle = getAngleFromMouse(e.clientX, e.clientY);
            lastMouseAngle = startAngle;
            const hint = document.querySelector('.drag-hint');
            if (hint) hint.style.display = 'none';
        }

        function handleMouseMove(e) {
            if (!isDragging) return;
            
            const mouseAngle = getAngleFromMouse(e.clientX, e.clientY);
            let deltaAngle = mouseAngle - lastMouseAngle;
            
            // 각도 차이가 180도보다 크면 반대 방향으로 계산
            if (deltaAngle > 180) deltaAngle -= 360;
            if (deltaAngle < -180) deltaAngle += 360;
            
            currentRotation += deltaAngle;
            lastMouseAngle = mouseAngle;
            
            const container = document.getElementById('cardContainer');
            container.style.transform = `rotate(${currentRotation}deg)`;
            
            updateVisibleCards();
        }

        function handleMouseUp() {
            isDragging = false;
            
            // 스냅 기능: 가장 가까운 카드 위치로 맞춤
            const snapAngle = 360 / cardCount;
            const snappedRotation = Math.round(currentRotation / snapAngle) * snapAngle;
            currentRotation = snappedRotation;
            
            const container = document.getElementById('cardContainer');
            container.style.transform = `rotate(${currentRotation}deg)`;
            
            updateVisibleCards();
        }

        // 이벤트 리스너 등록 (마우스 드래그만)
        document.addEventListener('mousedown', handleMouseDown);
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);

        // 페이지 로드시 카드 생성
        createCards();
    </script>
</body>
</html>